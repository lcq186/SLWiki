## 鸿磊对接需求 

##### 2021-07-12 

| V1.0.0 | 初始版本VB 版本抛数据 | 2021.07.12 | 李传权 |      |
| ------ | --------------------- | ---------- | ------ | ---- |
| V1.0.1 | 添加业务流程          | 2021.07.19 | 李传权 |      |
|        |                       |            |        |      |
|        |                       |            |        |      |

<div style="page-break-after: always;"></div>

###  1. 文档说明

####     1.1 阅读对象

​	 本开发文档的阅读对象具有熟悉 老版本测试仪软件.

###   2. 需求说明

#### 2.1	测试数据 Data.CSV  保存	

​	1.保存路径 可以自定义选择本地文件夹或网络路径.

###### 				 			<font color=#FF0000>更新原则  由于以往程序逻辑和其他业务流程不易修改所以不更改以前业务(关闭输出), 重新添加一个保存功能和文档输出.</font>

​	2.命名方式   "自定义目录/年/月/日/机器号\_工单号\_流水号.CSV"  

  	  按照批量开始日期 命名 
  	
  	  年 Format(Now,"yyyy")
  	
  	  月 Format(Now,"MM") 
  	  
  	  日 Format(Now,"dd")
  	
  	  流水号: Format(Now,"yyyyMMddHHmmss")
  	  
  	  批量结束后进行抛数据操作,导出数据覆盖文件并且根据分割设置进行分割文件.

​      

​	3. 文件格式

#### ![image-20210712110908649](https://lcq186-1256847298.cos.ap-nanjing.myqcloud.com/img/image-20210712110908649.png)

[文件格式](https://lcq186-1256847298.cos.ap-nanjing.myqcloud.com/img/image-20210712110908649.png)

1. 测试文件保存格式 为 .CSV   每列数据以逗号结尾,空行使用逗号表示.

2. 头部
    数列排序方式:   名称, 数据, 以逗号结尾

   横向排序: 项目名称  SPEC1_VF2	 表示 通道1 的vf2 ,在最后添加通道二SPEC2_VF2.... 列固定无数据填空.

   ​	Bin No.,BIN_CODE,SPEC1_VF2,SPEC1_VF1,SPEC1_LOP1,SPEC1_WP,SPEC1_WD,SPEC1_x,SPEC1_y,SPEC1_CCT,SPEC1_CRI,SPEC1_R9,SPEC1_Ir,SPEC1_Vz,

   SPEC1_ST .......

3. 数据统计

   项目列  站1, 站二,..........
   MAX,
   MIN,
   AVG,
   STD,
   NG,
   Cond_NG,
   
4.  数据关联 
   采用CodeNo关联 , VF2 映射小电流, SPEC1_LOP1 映射 Lm、mcd、mW/Sr (流明,光通量,辐射强度),其他对应具体项目Code,
   如发生项目冲突比如 有lm 也有mcd  ,SPEC1_LOP1值映射item 第一个出现的项目.

   5.保存文件机制

​        由于文件标题需要 OKbin 和Ng bin 统计信息 ,实现需要先缓存后抛出文档 .如需要实时存储需要另行文件操作.

#### 2.3 保存程式分BIN信息

1. 保存路径 可以自定义选着文件夹或网络路径.

2. 文件名固定 《明细表.csv》,并且覆盖已有文件名.

3. 导出时机  界面工单号更新不同后导出当前程式分BIN信息 

4. 文件格式 VB 当前版本 手动导出BIN信息 格式.

####  2.4  扫码输入信息并打开程式

1. 禁用手动操作打开程式 (重新打开软件加载上一次程式),品号,工单号必须扫码输入.

2. 扫入品号后根据品号精确查找测试部设置路径 『"D:\eTester\Program" 』品号.prg 文件加载.


#### 2.5  NG Bin 设置阈值报警

1. 当 BinBox 计数大于设定数量后报警并且停止测试.

2. 每次批量开始,计数重新开始(不影响之前程序Bin计数功能).

#### 2.6  自动保存校验证记录

1. 保存路径 可以自定义设置.

2. 文件命名方式    路径 + 品号 +工单号 + 扩展名.

3. 样管校正保存后并且记录.

4. 导出格式安装默认导出格式.

   

### 3. 业务流程 

~~~mermaid
graph TB
启动软件-->设置基本信息-->批量开始-->测试数据缓存到本地DB-->结束批量-->导出CSV文件到设定文件夹-->命名方式:/年/月/日/机器号_工单号_流水号.CSV
 设置基本信息-->Bin数量卡控-->设定Bin上限值-->大于设定{Bin数量超限}--是-->报警停机-->结束批量
设置基本信息-->工单号{工单号改变}--yes-->导出分bin信息-->命名方式:明细表.csv 
 
设置基本信息-->样管校正-->保存样管值-->导出样管-->命名方式:品号&工单命


~~~





​	

​     

######  

